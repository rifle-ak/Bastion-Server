roles:
  bastion:
    allowed_commands:
      - "uptime"
      - "df -h"
      - "df -h *"
      - "free -h"
      - "ps aux"
      - "ps aux *"
      - "top -bn1"
      - "dmesg *"
      - "ping -c * *"
      - "systemctl status *"
      - "systemctl list-units *"
      - "systemctl is-active *"
      - "journalctl -u * --no-pager -n *"
      - "journalctl -u * --no-pager -n * --since *"
      - "docker ps"
      - "docker ps *"
      - "docker logs *"
      - "cat /var/log/*"
      - "tail -n * /var/log/*"
    allowed_paths_read:
      - /var/log/
      - /etc/
      - /home/claude-agent/
    allowed_paths_write: []

  game-server:
    allowed_commands:
      # ── System health & diagnostics ──
      - "uptime"
      - "df -h"
      - "df -h *"
      - "free -h"
      - "free -m"
      - "ps aux"
      - "ps aux *"
      - "top -bn1"
      - "top -b -n *"
      - "dmesg *"
      - "ping -c * *"
      - "iostat *"
      - "vmstat *"
      - "mpstat *"
      - "w"
      - "who"
      - "last *"
      - "last"
      # ── Filesystem browsing ──
      - "ls *"
      - "ls"
      - "du -sh *"
      - "du -h *"
      - "du -sh /var/lib/pterodactyl/*"
      - "head -n * *"
      # ── Networking ──
      - "ss *"
      - "ss"
      - "ip addr"
      - "ip addr *"
      - "ip route"
      - "ip route *"
      - "ip -s link"
      - "ip -s link *"
      - "lsof *"
      - "lsof -i *"
      - "iptables -L"
      - "iptables -L *"
      - "iptables -S"
      - "iptables -S *"
      - "iptables -nL"
      - "iptables -nL *"
      - "nft list *"
      # ── Systemd services ──
      - "systemctl status *"
      - "systemctl list-units *"
      - "systemctl is-active *"
      - "systemctl show *"
      - "systemctl cat *"
      - "journalctl -u * --no-pager -n *"
      - "journalctl -u * --no-pager -n * --since *"
      - "journalctl -u * --no-pager --since *"
      - "journalctl --no-pager -n * -p *"
      # ── Docker: container listing & inspection ──
      - "docker ps"
      - "docker ps *"
      - "docker logs *"
      - "docker inspect *"
      - "docker stats --no-stream"
      - "docker stats --no-stream *"
      - "docker top *"
      - "docker port *"
      - "docker diff *"
      - "docker images"
      - "docker images *"
      - "docker history *"
      - "docker info"
      - "docker system df"
      - "docker system df *"
      # ── Docker: networking & volumes ──
      - "docker network ls"
      - "docker network ls *"
      - "docker network inspect *"
      - "docker volume ls"
      - "docker volume ls *"
      - "docker volume inspect *"
      # ── Docker exec: read-only container diagnostics ──
      - "docker exec * ps *"
      - "docker exec * ps"
      - "docker exec * top *"
      - "docker exec * df *"
      - "docker exec * df"
      - "docker exec * free *"
      - "docker exec * free"
      - "docker exec * uptime"
      - "docker exec * date"
      - "docker exec * cat *"
      - "docker exec * head *"
      - "docker exec * tail *"
      - "docker exec * ls *"
      - "docker exec * ls"
      - "docker exec * wc *"
      - "docker exec * du *"
      - "docker exec * find *"
      - "docker exec * grep *"
      - "docker exec * env"
      - "docker exec * printenv"
      - "docker exec * printenv *"
      - "docker exec * id"
      - "docker exec * whoami"
      - "docker exec * hostname"
      - "docker exec * uname *"
      - "docker exec * uname"
      - "docker exec * stat *"
      - "docker exec * mount"
      - "docker exec * ss *"
      - "docker exec * ip *"
      - "docker exec * netstat *"
      - "docker exec * lsof *"
      # ── Pterodactyl Wings CLI ──
      - "wings diagnostics"
      - "wings diagnostics *"
      - "wings version"
      # ── Pterodactyl: file reads (host-side paths) ──
      - "cat /etc/pterodactyl/*"
      - "cat /var/log/pterodactyl/*"
      - "cat /var/lib/pterodactyl/*"
      - "cat /srv/pterodactyl/*"
      - "head -n * /var/log/pterodactyl/*"
      - "head -n * /var/lib/pterodactyl/*"
      - "tail -n * /var/log/pterodactyl/*"
      - "tail -n * /var/lib/pterodactyl/*"
      - "tail -n * /srv/pterodactyl/*"
      - "ls -la /var/lib/pterodactyl/*"
      - "ls -lah /var/lib/pterodactyl/*"
      - "ls -la /etc/pterodactyl/*"
      - "ls -la /srv/pterodactyl/*"
      - "du -sh /var/lib/pterodactyl/volumes/*"
      - "du -sh /var/lib/pterodactyl/backups/*"
      - "find /var/lib/pterodactyl/* *"
      # ── Pterodactyl RCON — send commands to game console (REQUIRES APPROVAL) ──
      - "docker exec * rcon *"
      # ── Container management (REQUIRES APPROVAL) ──
      - "docker restart *"
      - "docker start *"
      - "docker stop *"
      - "docker kill *"
      - "systemctl restart *"
      - "systemctl stop *"
    allowed_paths_read:
      - /var/log/
      - /var/log/pterodactyl/
      - /etc/pterodactyl/
      - /srv/pterodactyl/
      - /var/lib/pterodactyl/
      - /tmp/pterodactyl/
    allowed_paths_write: []

  monitoring:
    allowed_commands:
      - "uptime"
      - "df -h"
      - "df -h *"
      - "free -h"
      - "ps aux"
      - "ps aux *"
      - "top -bn1"
      - "top -b -n *"
      - "dmesg *"
      - "ping -c * *"
      - "iostat *"
      - "vmstat *"
      - "systemctl status *"
      - "systemctl list-units *"
      - "systemctl is-active *"
      - "docker ps"
      - "docker ps *"
      - "docker logs *"
      - "docker stats --no-stream"
      - "docker stats --no-stream *"
      - "docker top *"
      - "docker inspect *"
      - "docker compose -f /opt/monitoring/* ps"
      - "docker compose -f /opt/monitoring/* logs *"
      - "docker compose -f /opt/monitoring/* restart *"
      - "journalctl -u * --no-pager -n *"
      - "journalctl -u * --no-pager -n * --since *"
    allowed_paths_read:
      - /var/log/
      - /opt/monitoring/
    allowed_paths_write: []

  webhost:
    allowed_commands:
      - "uptime"
      - "df -h"
      - "df -h *"
      - "free -h"
      - "ps aux"
      - "ps aux *"
      - "top -bn1"
      - "dmesg *"
      - "ping -c * *"
      - "systemctl status *"
      - "systemctl list-units *"
      - "systemctl is-active *"
      - "systemctl restart *"                       # REQUIRES APPROVAL
      - "journalctl -u * --no-pager -n *"
      - "journalctl -u * --no-pager -n * --since *"
      # cPanel/WHM
      - "/usr/local/cpanel/bin/whmapi1 *"
      - "/scripts/restartsrv_*"                     # REQUIRES APPROVAL
      - "/usr/local/cpanel/bin/cplogin"
      - "whmapi1 *"
      # Apache
      - "httpd -S"
      - "httpd -t"
      - "apachectl status"
      - "apachectl configtest"
      # MySQL
      - "mysqladmin status"
      - "mysqladmin processlist"
      # DNS
      - "named-checkconf"
      - "named-checkzone *"
      # Mail
      - "exim -bpc"
      - "exim -bp"
      # General
      - "cat /var/log/*"
      - "tail -n * /var/log/*"
      - "tail -n * /usr/local/cpanel/logs/*"
    allowed_paths_read:
      - /var/log/
      - /etc/httpd/
      - /etc/my.cnf.d/
      - /etc/named/
      - /usr/local/cpanel/logs/
      - /var/cpanel/
      - /etc/cpanel/
    allowed_paths_write: []

  saltbox:
    allowed_commands:
      - "uptime"
      - "df -h"
      - "df -h *"
      - "free -h"
      - "ps aux"
      - "ps aux *"
      - "top -bn1"
      - "top -b -n *"
      - "dmesg *"
      - "ping -c * *"
      - "iostat *"
      - "vmstat *"
      - "systemctl status *"
      - "systemctl list-units *"
      - "systemctl is-active *"
      - "journalctl -u * --no-pager -n *"
      - "journalctl -u * --no-pager -n * --since *"
      # Docker — Saltbox runs everything in containers
      - "docker ps"
      - "docker ps *"
      - "docker logs *"
      - "docker inspect *"
      - "docker stats --no-stream"
      - "docker stats --no-stream *"
      - "docker top *"
      - "docker restart *"                          # REQUIRES APPROVAL
      - "docker compose -f /opt/saltbox/* ps"
      - "docker compose -f /opt/saltbox/* logs *"
      - "docker compose -f /opt/saltbox/* restart *" # REQUIRES APPROVAL
      # Saltbox CLI
      - "sb status"
      - "sb list"
      - "sb restart *"                              # REQUIRES APPROVAL
      # Plex
      - "cat /opt/plex/Library/Application Support/Plex Media Server/Logs/*"
      - "tail -n * /opt/plex/Library/Application Support/Plex Media Server/Logs/*"
      # General logs
      - "cat /var/log/*"
      - "tail -n * /var/log/*"
    allowed_paths_read:
      - /var/log/
      - /opt/saltbox/
      - /opt/plex/
      - /opt/sonarr/
      - /opt/radarr/
      - /opt/nzbget/
      - /opt/overseerr/
      - /etc/docker/
    allowed_paths_write: []

approval_required_patterns:
  - "restart"
  - "stop"
  - "start"
  - "kill"
  - "rm "
  - "remove"
  - "delete"
  - "drop"
  - "truncate"
  - "write"
  - "tee "
  - ">"
  - ">>"
  - "rcon"
